<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>linux server使用clash | 炼丹小本本</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content=" ">
    
    <link rel="preload" href="/assets/css/0.styles.5cb60a5d.css" as="style"><link rel="preload" href="/assets/js/app.b3fe3ba4.js" as="script"><link rel="preload" href="/assets/js/2.cfef0441.js" as="script"><link rel="preload" href="/assets/js/15.dab8436a.js" as="script"><link rel="preload" href="/assets/js/7.58b74439.js" as="script"><link rel="prefetch" href="/assets/js/10.438ffba0.js"><link rel="prefetch" href="/assets/js/11.4bab1ac6.js"><link rel="prefetch" href="/assets/js/12.2f4b41ac.js"><link rel="prefetch" href="/assets/js/13.0aeb395e.js"><link rel="prefetch" href="/assets/js/14.3a0b5387.js"><link rel="prefetch" href="/assets/js/16.835e25b2.js"><link rel="prefetch" href="/assets/js/17.efd9d216.js"><link rel="prefetch" href="/assets/js/18.d632e635.js"><link rel="prefetch" href="/assets/js/19.52991b17.js"><link rel="prefetch" href="/assets/js/20.da6bc2c8.js"><link rel="prefetch" href="/assets/js/21.56851f4a.js"><link rel="prefetch" href="/assets/js/22.e6e286a5.js"><link rel="prefetch" href="/assets/js/23.a6f26e8a.js"><link rel="prefetch" href="/assets/js/24.ca8828db.js"><link rel="prefetch" href="/assets/js/25.4790468d.js"><link rel="prefetch" href="/assets/js/26.b14f5887.js"><link rel="prefetch" href="/assets/js/27.95c8a095.js"><link rel="prefetch" href="/assets/js/28.75ba33b0.js"><link rel="prefetch" href="/assets/js/29.bf29640d.js"><link rel="prefetch" href="/assets/js/3.f8bcfb9e.js"><link rel="prefetch" href="/assets/js/30.7c6729ab.js"><link rel="prefetch" href="/assets/js/31.967dfba2.js"><link rel="prefetch" href="/assets/js/32.23e576c6.js"><link rel="prefetch" href="/assets/js/4.c74e7165.js"><link rel="prefetch" href="/assets/js/5.ca9b8247.js"><link rel="prefetch" href="/assets/js/6.e34411cc.js"><link rel="prefetch" href="/assets/js/8.a52f8de6.js"><link rel="prefetch" href="/assets/js/9.ed221136.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5cb60a5d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">炼丹小本本</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Notes" class="dropdown-title"><span class="title">Notes</span> <span class="arrow down"></span></button> <button type="button" aria-label="Notes" class="mobile-dropdown-title"><span class="title">Notes</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic_operations_of_linux/index.html" class="nav-link">
  《Linux基操》
</a></li><li class="dropdown-item"><!----> <a href="/programming_magic/index.html" class="nav-link">
  《编程奇技淫巧》
</a></li></ul></div></div> <a href="https://github.com/zfhxi/Alchemy-Handbook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Notes" class="dropdown-title"><span class="title">Notes</span> <span class="arrow down"></span></button> <button type="button" aria-label="Notes" class="mobile-dropdown-title"><span class="title">Notes</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic_operations_of_linux/index.html" class="nav-link">
  《Linux基操》
</a></li><li class="dropdown-item"><!----> <a href="/programming_magic/index.html" class="nav-link">
  《编程奇技淫巧》
</a></li></ul></div></div> <a href="https://github.com/zfhxi/Alchemy-Handbook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/basic_operations_of_linux/" aria-current="page" class="sidebar-link">《Linux基操》</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>深度学习环境配置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Linux系统配置</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic_operations_of_linux/Linux系统配置/01-linux_static_ip.html" class="sidebar-link">Linux静态IP设定</a></li><li><a href="/basic_operations_of_linux/Linux系统配置/02-server_iptables_simple.html" class="sidebar-link">服务器iptables规则配置简单版</a></li><li><a href="/basic_operations_of_linux/Linux系统配置/03-user_add_del.html" class="sidebar-link">用户增删</a></li><li><a href="/basic_operations_of_linux/Linux系统配置/04-campus_network.html" class="sidebar-link">校园内网联网</a></li><li><a href="/basic_operations_of_linux/Linux系统配置/05-linux_mount_disk.html" class="sidebar-link">Linux挂载硬盘</a></li><li><a href="/basic_operations_of_linux/Linux系统配置/06-linux_cpu_freq.html" class="sidebar-link">Linux下CPU频率调整</a></li><li><a href="/basic_operations_of_linux/Linux系统配置/07-linux_clash.html" class="active sidebar-link">Linux下使用clash代理</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>效率神器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Shell零碎脚本</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="linux-server使用clash"><a href="#linux-server使用clash" class="header-anchor">#</a> linux server使用clash</h1> <blockquote><p>注：以下方案适用的场景为：为某一 命令行 设置代理</p></blockquote> <h2 id="安装proxychains4"><a href="#安装proxychains4" class="header-anchor">#</a> 安装ProxyChains4</h2> <p>先安装代理设置工具proxychains:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> proxychains4
</code></pre></div><p>这样就可以为需要执行的命令行设定代理了，比如测试谷歌是否能访问：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-i</span> google.com               <span class="token comment"># 没有通过代理，通常无法正确获得结果</span>
proxychains4 <span class="token function">curl</span> <span class="token parameter variable">-i</span> google.com  <span class="token comment"># 通过代理访问，可以获得正确返回结果</span>
</code></pre></div><p>设置代理端口<code>sudo vim /etc/proxychains4.conf</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#socks4         127.0.0.1 9050</span>
socks5 <span class="token number">127.0</span>.0.1 <span class="token number">7890</span>
</code></pre></div><p>注释socks4，添加socks5，并设定代理端口为7890</p> <h2 id="安装clash"><a href="#安装clash" class="header-anchor">#</a> 安装clash</h2> <p>去<a href="https://github.com/zhongfly/Clash-premium-backup/releases/tag/2023-09-05-gdcc8d87" target="_blank" rel="noopener noreferrer">此处<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>下载clash的linux版本（传到linux服务器上）:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>gunzip clash-linux-amd64-***.gz
<span class="token function">mv</span> clash-linux-amd64-v1.14.0 your_path/clash
</code></pre></div><p>运行clash需要Country.mmdb文件，依靠其利用GeoIP2服务能识别互联网用户的地点位置，以供规则分流时使用。去<a href="https://github.com/Dreamacro/maxmind-geoip/releases" target="_blank" rel="noopener noreferrer">此处<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>下载。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mv</span> Country.mmdb your_path
</code></pre></div><p>另外需要新建clash的配置文件<code>your_path/config.yaml</code>，由于官方避险删库了，这里提供一个模板：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">mixed-port</span><span class="token punctuation">:</span> <span class="token number">7890</span>
<span class="token key atrule">allow-lan</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">mode</span><span class="token punctuation">:</span> rule
<span class="token key atrule">log-level</span><span class="token punctuation">:</span> info
<span class="token key atrule">external-controller</span><span class="token punctuation">:</span> <span class="token string">'0.0.0.0:9090'</span>
<span class="token key atrule">external-ui</span><span class="token punctuation">:</span> ui
<span class="token key atrule">secret</span><span class="token punctuation">:</span> <span class="token string">'123456'</span>

<span class="token comment">## 保留上面，在下面填写你的机场订阅地址下载得到的your_config.yaml内容，删除your_config.yaml中上面对应的项，并删除本行。</span>
</code></pre></div><p>为了能保证外部web ui的访问，新建ui文件夹：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> your_path/ui
</code></pre></div><h2 id="运行"><a href="#运行" class="header-anchor">#</a> 运行</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>your_path/clash <span class="token parameter variable">-d</span> your_path

INFO<span class="token punctuation">[</span>0000<span class="token punctuation">]</span> Start initial compatible provider 故障转移       
INFO<span class="token punctuation">[</span>0000<span class="token punctuation">]</span> Start initial compatible provider 自动选择       
INFO<span class="token punctuation">[</span>0000<span class="token punctuation">]</span> Start initial compatible provider 节点选择       
INFO<span class="token punctuation">[</span>0000<span class="token punctuation">]</span> Mixed<span class="token punctuation">(</span>http+socks5<span class="token punctuation">)</span> proxy listening at: :7890 
INFO<span class="token punctuation">[</span>0000<span class="token punctuation">]</span> RESTful API listening at: <span class="token number">0.0</span>.0.0:9090 
</code></pre></div><p>浏览器打开控制台地址：</p> <p><a href="http://yacd.haishan.me/" target="_blank" rel="noopener noreferrer">http://yacd.haishan.me/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>在控制台页面，点击 “配置” -&gt; “切换后端”，填入地址：</p> <div class="language-text extra-class"><pre class="language-text"><code>API Base URL：linux服务器ip:设定的端口9090
密钥： 123456
</code></pre></div><p>之后就可以通过控制台页面进行配置了，但要注意的是：控制台页面操作的结果并不会保存到配置文件，只能是临时生效。</p> <h2 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h2> <p>常用方式：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>proxychains4 <span class="token operator">&lt;</span>your_cmd<span class="token operator">&gt;</span>       <span class="token comment"># 会有log信息</span>
proxychains4 <span class="token parameter variable">-q</span> <span class="token operator">&lt;</span>your_cmd<span class="token operator">&gt;</span>    <span class="token comment"># 无log信息</span>
</code></pre></div><p>假设需要克隆GitHub某个仓库的代码：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>proxychains4 <span class="token function">git</span> clone https://github.com/xxx/xxx
</code></pre></div><p>上述所需要下载的工具，我统一放在了<a href="https://pan.idzc.top/99Public/OneDrive/Tools/clash_for_linux" target="_blank" rel="noopener noreferrer">此处<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>参考：<br>
https://blog.iswiftai.com/posts/clash-linux/<br>
https://skyao.io/learning-linux-mint/docs/daily/network/clash.html</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zfhxi/Alchemy-Handbook/edit/main/docs/basic_operations_of_linux/Linux系统配置/07-linux_clash.md" target="_blank" rel="noopener noreferrer">Edit on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div id="vcomments"></div> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.b3fe3ba4.js" defer></script><script src="/assets/js/2.cfef0441.js" defer></script><script src="/assets/js/15.dab8436a.js" defer></script><script src="/assets/js/7.58b74439.js" defer></script>
  </body>
</html>
