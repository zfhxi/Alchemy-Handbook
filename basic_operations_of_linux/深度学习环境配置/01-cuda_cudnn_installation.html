<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CUDA/cuDNN安装 | 炼丹小本本</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content=" ">
    
    <link rel="preload" href="/assets/css/0.styles.db5e3e28.css" as="style"><link rel="preload" href="/assets/js/app.70c85457.js" as="script"><link rel="preload" href="/assets/js/2.cfef0441.js" as="script"><link rel="preload" href="/assets/js/25.eddd59bd.js" as="script"><link rel="preload" href="/assets/js/7.58b74439.js" as="script"><link rel="prefetch" href="/assets/js/10.438ffba0.js"><link rel="prefetch" href="/assets/js/11.fd7a25e3.js"><link rel="prefetch" href="/assets/js/12.2f4b41ac.js"><link rel="prefetch" href="/assets/js/13.231022aa.js"><link rel="prefetch" href="/assets/js/14.3a0b5387.js"><link rel="prefetch" href="/assets/js/15.703eb145.js"><link rel="prefetch" href="/assets/js/16.38439872.js"><link rel="prefetch" href="/assets/js/17.a88e0ae0.js"><link rel="prefetch" href="/assets/js/18.6b330f3c.js"><link rel="prefetch" href="/assets/js/19.3d874196.js"><link rel="prefetch" href="/assets/js/20.e6b31528.js"><link rel="prefetch" href="/assets/js/21.81c87ba5.js"><link rel="prefetch" href="/assets/js/22.a11fe7df.js"><link rel="prefetch" href="/assets/js/23.67272fd4.js"><link rel="prefetch" href="/assets/js/24.f295c206.js"><link rel="prefetch" href="/assets/js/26.25237f95.js"><link rel="prefetch" href="/assets/js/27.b6ce1a78.js"><link rel="prefetch" href="/assets/js/28.8332dcc7.js"><link rel="prefetch" href="/assets/js/29.bdfff596.js"><link rel="prefetch" href="/assets/js/3.9d173ece.js"><link rel="prefetch" href="/assets/js/30.6290200d.js"><link rel="prefetch" href="/assets/js/31.04ec0ef5.js"><link rel="prefetch" href="/assets/js/4.c95c1cfc.js"><link rel="prefetch" href="/assets/js/5.c2955b74.js"><link rel="prefetch" href="/assets/js/6.e34411cc.js"><link rel="prefetch" href="/assets/js/8.a52f8de6.js"><link rel="prefetch" href="/assets/js/9.f1fde147.js">
    <link rel="stylesheet" href="/assets/css/0.styles.db5e3e28.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">炼丹小本本</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Notes" class="dropdown-title"><span class="title">Notes</span> <span class="arrow down"></span></button> <button type="button" aria-label="Notes" class="mobile-dropdown-title"><span class="title">Notes</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic_operations_of_linux/index.html" class="nav-link">
  《Linux基操》
</a></li><li class="dropdown-item"><!----> <a href="/programming_magic/index.html" class="nav-link">
  《编程奇技淫巧》
</a></li></ul></div></div> <a href="https://github.com/zfhxi/Alchemy-Handbook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Notes" class="dropdown-title"><span class="title">Notes</span> <span class="arrow down"></span></button> <button type="button" aria-label="Notes" class="mobile-dropdown-title"><span class="title">Notes</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/basic_operations_of_linux/index.html" class="nav-link">
  《Linux基操》
</a></li><li class="dropdown-item"><!----> <a href="/programming_magic/index.html" class="nav-link">
  《编程奇技淫巧》
</a></li></ul></div></div> <a href="https://github.com/zfhxi/Alchemy-Handbook" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/basic_operations_of_linux/" aria-current="page" class="sidebar-link">《Linux基操》</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>深度学习环境配置</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic_operations_of_linux/深度学习环境配置/01-cuda_cudnn_installation.html" class="active sidebar-link">CUDA/cuDNN安装</a></li><li><a href="/basic_operations_of_linux/深度学习环境配置/02-anaconda_miniconda3_installation.html" class="sidebar-link">Anaconda/Miniconda3安装</a></li><li><a href="/basic_operations_of_linux/深度学习环境配置/03-pip_conda_install_pkg_offline.html" class="sidebar-link">pip/conda离线安装软件包</a></li><li><a href="/basic_operations_of_linux/深度学习环境配置/04-install_matlab_r2017b.html" class="sidebar-link">命令行安装Matlab R2017b</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux系统配置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>效率神器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Shell零碎脚本</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="cuda-cudnn安装"><a href="#cuda-cudnn安装" class="header-anchor">#</a> CUDA/cuDNN安装</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>1）大多数情况下，用户会事先安装nvidia驱动。</p> <p>Linux如果已经安装nvidia驱动，可输入<code>nvidia-smi</code>查看<code>driver api</code>的cuda版本。</p> <p>而当你成功cuda后，输入<code>nvcc --version</code>得到的<code>runtime api</code>的cuda版本与<code>driver api</code>的cuda版本不一致。</p> <p>windows下，右键→nvidia控制面板→帮助→系统信息→组件→NVCUDA64.DLL项的产品名称会显示<code>driver api</code>的cuda版本。</p> <p>2）上面版本不一致，大概率是因为用户事先单独安装了nvidia驱动，而不是使用cuda包中集成的GPU Installer Driver。当然下面是先单独安装了nvidia驱动（因为有时有多cuda版本的需求，没必要使用集成驱动，也可以灵活处理），如何处理确实考验用户的敏捷了。</p> <blockquote><p><code>driver api</code>的版本能向下兼容<code>runtime api</code>的版本，即nvidia-smi 显示的版本大于nvcc --version 的版本通常不会出现大问题。</p></blockquote> <p>参考：<a href="https://www.jianshu.com/p/eb5335708f2a" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/eb5335708f2a<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="版本对应表"><a href="#版本对应表" class="header-anchor">#</a> 版本对应表</h2> <h3 id="pytorch"><a href="#pytorch" class="header-anchor">#</a> PyTorch</h3> <p>最新版本参考：<a href="https://pytorch.org/get-started/locally/" target="_blank" rel="noopener noreferrer">https://pytorch.org/get-started/locally/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>历史版本参考：<a href="https://pytorch.org/get-started/previous-versions/" target="_blank" rel="noopener noreferrer">https://pytorch.org/get-started/previous-versions/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="tensorflow"><a href="#tensorflow" class="header-anchor">#</a> TensorFlow</h3> <p><a href="https://tensorflow.google.cn/install/source#linux" target="_blank" rel="noopener noreferrer">https://tensorflow.google.cn/install/source#linux<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="cuda与cudnn版本对应"><a href="#cuda与cudnn版本对应" class="header-anchor">#</a> cuda与cudnn版本对应</h3> <p><a href="https://developer.nvidia.com/rdp/cudnn-archive" target="_blank" rel="noopener noreferrer">https://developer.nvidia.com/rdp/cudnn-archive<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="archlinux下安装-限管理员"><a href="#archlinux下安装-限管理员" class="header-anchor">#</a> ArchLinux下安装（限管理员）</h2> <ul><li><p>这是不建议的方式，尽管ArchLinux的AUR仓库提供了很多深度学习、机器学习软件包，但是他们严重依赖某一cuda版本，不建议用AUR安装大多数的、深度学习相关的包。</p> <p>以下在GTX 1660TI、RTX 3090下测试。</p> <p>1）如果你能保证仓库中的最新版CUDA、cuDNN适合你的环境的话，直接执行：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>pacman <span class="token parameter variable">-S</span> nvidia-lts cuda cudnn
</code></pre></div><p>然而通常并不能做这样的保证，所以需要自己下载对应的版本</p> <p>2）你可以先在<a href="https://archive.archlinux.org/packages/c/" target="_blank" rel="noopener noreferrer">https://archive.archlinux.org/packages/c/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>或清华源<a href="https://arch-archive.tuna.tsinghua.edu.cn/" target="_blank" rel="noopener noreferrer">https://arch-archive.tuna.tsinghua.edu.cn/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的community库中（推荐后者）找到合适的cuda、cudnn版本，下载pkg.tar.zst文件</p> <p>[可选]然后拷贝文件到<code>/var/pacman/cache/pkg</code>目录，并cd到此</p> <p>然后执行：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> pacman <span class="token parameter variable">-U</span> cuda-xxxx-x86_64.pkg.tar.zst
<span class="token function">sudo</span> pacman <span class="token parameter variable">-U</span> cudnn-xxxx-x86_64.pkg.tar.zst
</code></pre></div><p>如果你安装了最新的版本，也可以通过2）的操作配合<a href="https://wiki.archlinux.org/title/Downgrading_packages_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)" target="_blank" rel="noopener noreferrer">downgrade<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>工具来降级。</p> <p>最后为了防止管理员手抽筋执行了<code>sudo pacman -Syyu</code>导致升级cuda、cudnn，因此修改/etc/pacman.conf来忽略这些包的升级：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>IgnorePkg <span class="token operator">=</span> cuda cudnn
</code></pre></div></li></ul> <h2 id="debian下安装"><a href="#debian下安装" class="header-anchor">#</a> Debian下安装</h2> <p>驱动需要管理员身份安装，CUDA、cuDNN部分可由普通用户选择安装自己有权限的目录里（这适用于需要使用多cuda版本的场景）。</p> <p>以下在TITAN RTX V下测试。</p> <h3 id="安装nvidia驱动"><a href="#安装nvidia驱动" class="header-anchor">#</a> 安装NVIDIA驱动</h3> <p>由于各种原因，Debian10安装好后，我已将开源驱动给禁掉了。</p> <p>注意事项：</p> <ul><li><p>据说在以下步骤进行之前，你需要在bios里关闭secure boot，否则安装NVIDIA驱动时会报错；</p> <p><code>The target kernel has CONFIG_MODULE_SIG set, which means that it supports cryptographic signatures on kernel modules. On some systems, the kernel may refuse to load modules without a valid signature from a trusted key. This system also has UEFI Secure Boot enabled; many distributions enforce module signature verification on UEFFI systems when SecureBoot is enable. Would you like to sign NVIDIA kernel module?</code></p></li> <li><p>以下步骤都在tty下进行，所以建议关闭图形界面。</p> <p><em><strong>方案1:关闭图形界面</strong></em></p> <p>参考：<a href="https://blog.51cto.com/u_15127583/4259155" target="_blank" rel="noopener noreferrer">debian关闭图形界面_配置Debian系统不启用图形界面，只有命令行界面的方法_51CTO博客_debian 关闭图形界面<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>1.打开grup配置文件：<code>sudo vi /etc/default/grub</code></p> <p>2.修改：将<code>GRUB_CMDLINE_LINUX=&quot;&quot;</code> 修改为：<code>GRUB_CMDLINE_LINUX=&quot;text&quot;</code></p> <p>3.更新grub：<code>sudo update-grub</code></p> <p>4.更新系统服务管理器配置：<code>sudo  systemctl set-default multi-user.target</code></p> <p>5.重启：<code>sudo init 6</code></p> <p><em><strong>方案2:临时关闭X server</strong></em></p> <p>1.查看当前桌面管理器: <code>cat /etc/X11/default-display-manager</code></p> <p>2.停止服务: <code>sudo systemctl stop lightdm</code></p></li></ul> <p>先禁用闭源驱动：</p> <p><code>sudo vi /etc/modprobe.d/black_nouveau.conf</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>blacklist nouveau
options nouveau <span class="token assign-left variable">modeset</span><span class="token operator">=</span><span class="token number">0</span>
</code></pre></div><p>需要卸载已有的驱动：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> remove <span class="token parameter variable">--purge</span> nvidia*
<span class="token function">sudo</span> <span class="token function">apt</span> remove <span class="token parameter variable">--purge</span> *nvidia*
<span class="token function">sudo</span> <span class="token function">apt</span> autoremove
</code></pre></div><p>然后更新内核：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> update-initramfs <span class="token parameter variable">-u</span>
</code></pre></div><p>显卡是TITAN RTX，去官网下载对应驱动<code>NVIDIA-Linux-x86_64-460.84.run</code></p> <p>安装之前安装以下需要依赖的包：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> build-essential pkg-config <span class="token comment"># 未测式不安装会不会出问题</span>
<span class="token comment"># (编译Sample时所需的依赖包) 以下命令我并未执行</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> freeglut3-dev libx11-dev libxmu-dev libxi-dev libgl1-mesa libgl1-mesa-dri libglu1-mesa libglu1-mesa-dev
</code></pre></div><p>安装<code>linux-headers</code>：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">uname</span> <span class="token parameter variable">-r</span> <span class="token comment"># 返回4.19.xxx</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> linux-headers-4.19 <span class="token comment"># 4.19根据uname -r</span>
</code></pre></div><p>保证是在tty下进行：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">chmod</span> +x NVIDIA-Linux-x86_64-460.84.run
./NVIDIA-Linux-x86_64-460.84.run
</code></pre></div><p>基本上一直选YES就对了</p> <p>然后执行如下来检测驱动是否装上：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>nvidia-smi
</code></pre></div><h3 id="安装cuda"><a href="#安装cuda" class="header-anchor">#</a> 安装CUDA</h3> <blockquote><p>注：如果你作为普通用户安装，那么下面的安装目录就不要选/usr/local/cudaxxx了，并且去除命令中的sudo。</p></blockquote> <p>官网<a href="https://developer.nvidia.com/cuda-downloads" target="_blank" rel="noopener noreferrer">CUDA最新版本<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>官网<a href="https://developer.nvidia.com/cuda-toolkit-archive" target="_blank" rel="noopener noreferrer">CUDA历史版本<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>查看architecture：<code>uname -a</code></p> <p>查看distribution：<code>lsb_release -a</code></p> <p>Installer Type 选择runfile(local)</p> <p>下载cuda：<code>cuda_10.2.89_440.33.01_linux.run</code></p> <p>执行：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">chmod</span> u+x cuda_10.2.89_440.33.01_linux.run
<span class="token function">sudo</span> <span class="token function">bash</span> cuda_10.2.89_440.33.01_linux.run
</code></pre></div><ul><li>如果要自定义目录，你可能需要使用<code>--toolkitpath=/path</code>选项或者在下图的Options里选择；</li> <li>如果出现gcc不兼容，加入<code>—override</code>选项（参考<a href="https://blog.csdn.net/HaoZiHuang/article/details/109544443" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/HaoZiHuang/article/details/109544443<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）</li></ul> <p>选择如下（不覆盖驱动）：</p> <blockquote><ol><li>图中的选中、取消是通过空格来完成。下图是过时的图片。</li> <li>通常而言只需要勾选CUDA Toolkit就可以了，其他的都不需要。新版本的nvidia-fs一般不选（我目前所接触的资源不够使用这种东西）</li> <li>建议点击到Options里去设置一下，这样可以自定义安装路径，而不是默认的/usr/local/cuda-10.2（如果你的用户不具备管理员权限，你读默认目录是不具备写权限的，可以更改为当前普通用户可读写的目录）。</li> <li>另外建议不要选中create symbol link，因为这样会在/usr/local/bin下创建一个cuda的软链接，这样会导致系统中的cuda命令被覆盖，而且这个软链接是不可删除的，所以建议不要选中这个选项。</li> <li>不需要创建desktop entry桌面图标。</li></ol></blockquote> <p><img src="https://img.idzc.top/picgoimg/202108162355416.png" alt="https://img.idzc.top/picgoimg/202108162355416.png"></p> <p>安装完后的信息：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>lzq@titan:~/Downloads$ <span class="token function">sh</span> cuda_10.2.89_440.33.01_linux.run 
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token operator">=</span> Summary <span class="token operator">=</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>

Driver:   Not Selected
Toolkit:  Installed <span class="token keyword">in</span> /usr/local/cuda-10.2/
Samples:  Installed <span class="token keyword">in</span> /home/lzq/, but missing recommended libraries

Please <span class="token function">make</span> sure that
 -   <span class="token environment constant">PATH</span> includes /usr/local/cuda-10.2/bin
 -   LD_LIBRARY_PATH includes /usr/local/cuda-10.2/lib64, or, <span class="token function">add</span> /usr/local/cuda-10.2/lib64 to /etc/ld.so.conf and run ldconfig as root

To uninstall the CUDA Toolkit, run cuda-uninstaller <span class="token keyword">in</span> /usr/local/cuda-10.2/bin

Please see CUDA_Installation_Guide_Linux.pdf <span class="token keyword">in</span> /usr/local/cuda-10.2/doc/pdf <span class="token keyword">for</span> detailed information on setting up CUDA.
***WARNING: Incomplete installation<span class="token operator">!</span> This installation did not <span class="token function">install</span> the CUDA Driver. A driver of version at least <span class="token number">440.00</span> is required <span class="token keyword">for</span> CUDA <span class="token number">10.2</span> functionality to work.
To <span class="token function">install</span> the driver using this installer, run the following command, replacing <span class="token operator">&lt;</span>CudaInstaller<span class="token operator">&gt;</span> with the name of this run file:
    <span class="token function">sudo</span> <span class="token operator">&lt;</span>CudaInstaller<span class="token operator">&gt;</span>.run <span class="token parameter variable">--silent</span> <span class="token parameter variable">--driver</span>

Logfile is /var/log/cuda-installer.log
</code></pre></div><p>根据上面的提示，我们需要添加环境变量。如果你是小白，（修改路径后）执行如下命令：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">'export CUDA_HOME=/usr/local/cuda-10.2
export LD_LIBRARY_PATH=$CUDA_HOME/lib64:$LD_LIBRARY_PATH
export PATH=$CUDA_HOME/bin:$PATH'</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc
</code></pre></div><p>然后<code>source ~/.bashrc</code>，再<code>nvcc -V</code>进行检查安装是否成功：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>nvcc: NVIDIA <span class="token punctuation">(</span>R<span class="token punctuation">)</span> Cuda compiler driver
Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2005</span>-2019 NVIDIA Corporation
Built on Wed_Oct_23_19:24:38_PDT_2019
Cuda compilation tools, release <span class="token number">10.2</span>, V10.2.89
</code></pre></div><p>or</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">cat</span>  <span class="token variable">$CUDA_HOME</span>/version.txt
</code></pre></div><h3 id="安装cudnn"><a href="#安装cudnn" class="header-anchor">#</a> 安装cuDNN</h3> <p>官网<a href="https://developer.nvidia.com/rdp/cudnn-archive" target="_blank" rel="noopener noreferrer">https://developer.nvidia.com/rdp/cudnn-archive<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>按版本对应下载<code>cudnn-10.2-linux-x64-v8.2.0.53.tgz</code>。</p> <p>解压<code>tar xzvf cudnn*.tgz</code>或<code>tar xvf cudnn*.tar.xz</code>后，执行（注意版本号对应）：</p> <p>如果你前面的CUDA安装成功了，也可以执行：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> cudnn-*-archive/
<span class="token function">sudo</span> <span class="token function">cp</span> include/cudnn*.h <span class="token variable">$CUDA_HOME</span>/include 
<span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-P</span> lib/libcudnn* <span class="token variable">$CUDA_HOME</span>/lib64
<span class="token function">sudo</span> <span class="token function">chmod</span> a+r <span class="token variable">$CUDA_HOME</span>/include/cudnn*.h <span class="token variable">$CUDA_HOME</span>/lib64/libcudnn*
</code></pre></div><p>通过<code>cat $CUDA_HOME/include/cudnn.h | grep CUDNN_MAJOR -A 2</code>，确认是否安装成功（或者<code>cat $CUDA_HOME/include/cudnn_version.h</code>）</p> <p><img src="https://img.idzc.top/picgoimg/202108162356580.png" alt="https://img.idzc.top/picgoimg/202108162356580.png"></p> <h2 id="windows下"><a href="#windows下" class="header-anchor">#</a> Windows下</h2> <p>以下在GTX 1050TI下测试。</p> <p>1）官网<a href="https://link.ailemon.net/?target=https://developer.nvidia.com/cuda-downloads" target="_blank" rel="noopener noreferrer">https://link.ailemon.net/?target=https://developer.nvidia.com/cuda-downloads<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>(最新版本)or<a href="https://link.ailemon.net/?target=https://developer.nvidia.com/cuda-toolkit-archive" target="_blank" rel="noopener noreferrer">https://link.ailemon.net/?target=https://developer.nvidia.com/cuda-toolkit-archive<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>(历史版本)</p> <p>下载cuda：<code>cuda_11.1.1_456.81_win10.exe</code></p> <p>在<a href="https://developer.nvidia.com/rdp/cudnn-archive" target="_blank" rel="noopener noreferrer">https://developer.nvidia.com/rdp/cudnn-archive<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>下载cudnn：<code>cudnn-11.1-windows-x64-v8.0.5.39.zip</code></p> <p>2）下载完后，先安装cuda，打开exe文件，基本上点点就完事儿，注意下面的选择（只选cuda）：</p> <p><img src="https://img.idzc.top/picgoimg/202110031014907.png" alt="https://img.idzc.top/picgoimg/202110031014907.png"></p> <p>NVIDIA GeForce Experience是游戏相关的驱动（不会没人还没装吧？）Other里好像是physx，Driver components是显示驱动，讲道理你如果事先安装了NVIDIA驱动，下面这3个都是已经安装了的，没必要又替换。</p> <p>3）下面调整下安装路径（任意）：</p> <p><img src="https://img.idzc.top/picgoimg/202110031021084.png" alt="https://img.idzc.top/picgoimg/202110031021084.png"></p> <p>4）执行<code>nvcc --version</code>查看cuda是否安装成功。</p> <p>5）解压缩cudnn-xxx.zip，将对应的bin、include、lib文件夹与cuda安装目录下的对应目录进行合并，理论上不会出现覆盖。</p> <p>win+R 输入sysdm.cpl→高级→环境变量，来添加环境变量</p> <p>系统变量的<code>CUDA_PATH</code>保证值为刚才的安装目录：如<code>D:\02DevelopTools\cuda11.1\computing_toolkit</code></p> <p>然后Path里添加记录：</p> <p><code>%CUDA_PATH%\bin</code></p> <p><code>D:\02DevelopTools\cuda11.1\computing_toolkit\lib\x64</code></p> <h2 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h2> <p>假如你已经安装了pytorch或者tensorflow：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 检查是否可用，理应返回True、0</span>
python <span class="token parameter variable">-c</span> <span class="token string">'import torch;print(torch.cuda.is_available())'</span>
python <span class="token parameter variable">-c</span> <span class="token string">'import torch;print(torch.cuda.current_device())'</span>
python <span class="token parameter variable">-c</span> <span class="token string">'import tensorflow as tf;print(tf.test.is_gpu_available())'</span>

<span class="token comment"># 查看当前环境的cuda、cudnn版本</span>
python <span class="token parameter variable">-c</span> <span class="token string">'import torch;print(torch.version.cuda)'</span>
python <span class="token parameter variable">-c</span> <span class="token string">'import torch;print(torch.backends.cudnn.version())'</span>
</code></pre></div><h2 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h2> <p>注：当我安装CUDA 11.1时，似乎直接通过pip install torch安装的torch并不能识别到cuda，因此参考了官方的<a href="https://pytorch.org/get-started/locally/" target="_blank" rel="noopener noreferrer">https://pytorch.org/get-started/locally/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，去<a href="https://download.pytorch.org/whl/torch_stable.html" target="_blank" rel="noopener noreferrer">https://download.pytorch.org/whl/torch_stable.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 里下对应cu111/xxxx-cpxxx-xxx.whl文件来安装后（或者直接<code>pip3 install torch==1.9.1+cu111 torchvision==0.10.1+cu111 torchaudio===0.9.1 -f [https://download.pytorch.org/whl/torch_stable.html](https://download.pytorch.org/whl/torch_stable.html)</code>），就可以识别cuda。</p> <blockquote><p>如果使用PyCharm，可能需要按照以下条目复制粘贴到PyCharm的右上角→ Edit Configurations→Environment  variables里：</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 注意以下理应只需更改cuda的安装路径，以下是/usr/local/cuda-10.2，可以使用which nvcc查看安装的路径</span>
<span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span>/usr/local/cuda-10.2/lib64:<span class="token variable">$LD_LIBRARY_PATH</span>
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/cuda-10.2/bin:<span class="token environment constant">$PATH</span>
</code></pre></div><p>参考：</p> <p><a href="https://blog.csdn.net/zhouchen1998/article/details/107778087" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/zhouchen1998/article/details/107778087<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.ailemon.net/2020/07/27/windows-install-cuda-and-cudnn-environment/" target="_blank" rel="noopener noreferrer">https://blog.ailemon.net/2020/07/27/windows-install-cuda-and-cudnn-environment/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://zhuanlan.zhihu.com/p/29841665" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/29841665<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zfhxi/Alchemy-Handbook/edit/main/docs/basic_operations_of_linux/深度学习环境配置/01-cuda_cudnn_installation.md" target="_blank" rel="noopener noreferrer">Edit on GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div id="vcomments"></div> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.70c85457.js" defer></script><script src="/assets/js/2.cfef0441.js" defer></script><script src="/assets/js/25.eddd59bd.js" defer></script><script src="/assets/js/7.58b74439.js" defer></script>
  </body>
</html>
